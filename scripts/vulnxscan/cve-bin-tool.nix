# SPDX-FileCopyrightText: 2023 Technology Innovation Institute (TII)
#
# SPDX-License-Identifier: Apache-2.0

{ nixpkgs ? <nixpkgs>
, pkgs ? import nixpkgs {}
, pythonPackages ? pkgs.python3Packages
, lib ? pkgs.lib
}:

let
  lib4sbom = pythonPackages.buildPythonPackage rec {
    version = "0.3.1";
    pname="lib4sbom";
    format = "setuptools";
    src = pkgs.fetchFromGitHub {
      owner = "anthonyharrison";
      repo = "lib4sbom";
      rev = "v${version}";
      hash = "sha256-RfJ7V4VRYlceGl4xlTMmm2kHNtxNryb+JHvZQakkM7w=";
    };
    propagatedBuildInputs = with pythonPackages; [
      pyyaml
      semantic-version
    ];
    doCheck = false;
  };
in
pythonPackages.buildPythonPackage rec {
  version = "3.2.1";
  pname = "cve-bin-tool";

  src = pkgs.fetchFromGitHub {
    owner = "henrirosten";
    repo = pname;
    rev = "7b5d0160032e067fcea69194c5c2e29ba4c6ae4d";
    hash = "sha256-y7cQwV8xblcZ13QeRe0IaeXX7dJk5EmvAxjq2RzyEXw=";
  };
  propagatedBuildInputs = with pythonPackages; [
    pkgs.google-cloud-sdk
    lib4sbom
    python-gnupg
    jsonschema
    plotly
    beautifulsoup4
    pyyaml
    isort
    py
    jinja2
    rpmfile
    reportlab
    zstandard
    rich
    aiohttp
    toml
    distro
    aiodns
    brotlipy
    faust-cchardet
    pillow
    setuptools
    xmlschema
    cvss
    packaging
  ];
  doCheck = false;
}
